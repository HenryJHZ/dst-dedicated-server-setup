#install dependencies and add new user
sudo apt-get install libstdc++6:i386 libgcc1:i386 libcurl4-gnutls-dev:i386
sudo apt-get install screen
sudo useradd -m totoro
sudo passwd totoro

su - totoro


#install steamcmd and dont starve together
mkdir ~/steamcmd
cd ~/steamcmd
wget https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz
tar -xvzf steamcmd_linux.tar.gz
./steamcmd.sh +login anonymous +force_install_dir ~/dst +app_update 343050 validate +quit


#config mods
echo 'ServerModCollectionSetup("1420925490")' >> /home/totoro/dst/mods/dedicated_server_mods_setup.lua

cd /home/totoro

printf '#!/bin/bash \ncd /home/steam/steamcmd \n./steamcmd.sh +login anonymous +force_install_dir /home/steam/steamapps/dst +app_update 343050 validate +quit' > dst_update.sh

printf '#!/bin/bash
\ncd /home/steam/steamapps/dst/bin
\nscreen -dmS dst_Cluster_1_master  ./dontstarve_dedicated_server_nullrenderer -console -cluster Cluster_1 -shard Master
\nscreen -dmS dst_Cluster_1_caves  ./dontstarve_dedicated_server_nullrenderer -console -cluster Cluster_1 -shard Caves' >dst_start_Cluster_1_withcave.sh

printf '#!/bin/bash
\ncd /home/steam/steamapps/dst/bin
\nscreen -dmS dst_Cluster_1_master  ./dontstarve_dedicated_server_nullrenderer -console -cluster Cluster_1 -shard Master' >dst_start_Cluster_1_withoutcave.sh


chmod +x ./dst_update.sh ./dst_start_Cluster_1_withcave.sh ./dst_start_Cluster_1_withoutcave.sh
